# ==========================================
# GHOSTPORT CONFIGURATION v4.0 (Noise + RBAC)
# ==========================================

[server]
listen_ip = "0.0.0.0"
listen_port = 8443
tls_enabled = true
cert_path = "./certs/server.crt"
key_path = "./certs/server.key"
max_connections = 1000

[backend]
target_addr = "127.0.0.1:8080"
target_host = "myapp.local"

[security]
enable_deep_analysis = true
session_timeout = 300
# The Encrypted Private Key for the Noise Server (Base64)
# Run `ghostport keygen --master-key "secret"` to generate.
# Ensure GHOSTPORT_MASTER_KEY env var is set to "secret" when running the server.
encrypted_private_key = "i0KicWePaJUgdco66BGANMsDJAXoAYjuvPVHrZYjT98I0RUPbkz1p1+31/VgDWONGAyZFoRc6l2s/L+b"
# Server's public_key = RnYhLaORiMPZ+IIufaaooSxl/Nb1vXTlVz17FnxmljY=

# Optional: List of authorized Client Public Keys (if not using [[users]] list)
# authorized_keys = []

[security.ban]
enabled = true
ban_duration = 3600
max_violations = 3

# --- USERS ---
# Map Client Public Keys to Identity & Roles

[[users]]
username = "user_admin"
roles = ["superadmin", "dev"] 
# The Client's Public Key (Base64)
public_key = "REPLACE_WITH_CLIENT_PUBLIC_KEY"

[[users]]
username = "bob"
roles = ["auditor"]
public_key = "REPLACE_WITH_CLIENT_PUBLIC_KEY_2"

# --- RULES ---

# Rule 1: The Fortress (Only SuperAdmins)
[[rules]]
path = "/admin"
type = "private"
allowed_roles = ["superadmin"] 
on_fail = "honeypot"

# Rule 2: The Logs (Auditors AND SuperAdmins)
[[rules]]
path = "/logs"
type = "private"
allowed_roles = ["superadmin", "auditor"]
on_fail = "block"

# Rule 3: Public
[[rules]]
path = "/"
type = "public"
strict_waf = true
on_fail = "block"

[reporting]
webhook_url = "https://discord.com/api/webhooks/12345/abcde"
log_all_requests = false